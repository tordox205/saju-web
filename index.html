<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‚¬ì£¼ í’€ì´</title>
  <style>
    :root{
      --bg:#0f1320; --fg:#eef2ff; --muted:#9aa3b2;
      --card:#141a33; --line:#243055; --accent:#76a7ff;
      --love:#ffe8ef; --money:#e8fff1; --job:#e8f1ff; --health:#fff6e8;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      color:var(--fg);
      background:linear-gradient(180deg,#0b1020,#0c1226 35%,#0b1020 100%);
    }
    .wrap{max-width:880px;margin:28px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    header h1{font-size:22px;margin:0}
    header .sub{color:var(--muted);font-size:13px}

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.18);
    }
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){ .grid{grid-template-columns:1fr} }

    label{display:block; margin:8px 0 6px; font-weight:600}
    input,select,textarea,button{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line);
      background:#0e1530; color:var(--fg); outline:none;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(118,167,255,.2)}
    textarea{min-height:92px; resize:vertical}

    .actions{display:flex; gap:10px; align-items:center; margin-top:8px}
    .btn{
      background:linear-gradient(180deg,#7db3ff,#6aa2ff 60%,#5b94fb 100%);
      color:#091224; border:none; font-weight:700; letter-spacing:.2px; cursor:pointer;
      transition:transform .05s ease, filter .2s ease; padding:10px 14px; border-radius:12px;
    }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{filter:grayscale(1); opacity:.6; cursor:not-allowed}

    .out{margin-top:16px}
    .result{
      border:1px dashed var(--line); border-radius:14px; padding:16px; background:#0e1430;
    }
    .badges{display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 2px}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      font-size:12px; border:1px solid rgba(255,255,255,.08); color:#0f172a; font-weight:700}
    .badge.love{background:var(--love)} .badge.money{background:var(--money)}
    .badge.job{background:var(--job)} .badge.health{background:var(--health)}

    .kv{display:grid; grid-template-columns:112px 1fr; gap:10px; margin:10px 0}
    @media (max-width:520px){ .kv{grid-template-columns:1fr} .kv b{display:block;margin-bottom:4px} }
    .muted{color:var(--muted); font-size:13px}
    .small{color:var(--muted); font-size:12px; margin-top:10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .hl{color:#bfe1ff}
    .tips li{margin:4px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì‚¬ì£¼ í’€ì´</h1>
      <span class="sub">ê°€ë²¼ìš´ í‚¤ì›Œë“œ ë£°ë¡œ ì˜¤ëŠ˜ í•œ ì¤„ ì¡°ì–¸ê¹Œì§€</span>
    </header>

    <section class="card">
      <div class="grid">
        <div>
          <label for="name">ì´ë¦„</label>
          <input id="name" placeholder="ì´ë¦„(ì„ íƒ)"/>
        </div>
        <div>
          <label for="birth">ìƒë…„ì›”ì¼</label>
          <input id="birth" type="date" />
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="hour">íƒœì–´ë‚œ ì‹œê°</label>
          <select id="hour">
            <option value="" selected>ì„ íƒí•˜ì„¸ìš”</option>
            <option value="0">ì(23~01)</option><option value="2">ì¶•(01~03)</option>
            <option value="4">ì¸(03~05)</option><option value="6">ë¬˜(05~07)</option>
            <option value="8">ì§„(07~09)</option><option value="10">ì‚¬(09~11)</option>
            <option value="12">ì˜¤(11~13)</option><option value="14">ë¯¸(13~15)</option>
            <option value="16">ì‹ (15~17)</option><option value="18">ìœ (17~19)</option>
            <option value="20">ìˆ (19~21)</option><option value="22">í•´(21~23)</option>
          </select>
          <div class="small">ì •í™•í•œ ì‹œê°ì„ ëª¨ë¥´ë©´ ëŒ€ëµ ê·¼ì‚¬ê°’ì„ ì„ íƒí•´ë„ ë©ë‹ˆë‹¤.</div>
        </div>
        <div>
          <label for="q">ì§ˆë¬¸/ê³ ë¯¼(ì„ íƒ)</label>
          <textarea id="q" placeholder=""></textarea>
        </div>
      </div>

      <div class="actions">
        <button id="run" class="btn">í’€ì´í•˜ê¸°</button>
        <span class="muted mono">Enterë¡œë„ ì‹¤í–‰(ì§ˆë¬¸ì¹¸ ì œì™¸)</span>
      </div>

      <div class="out">
        <div id="out" class="result muted">ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <p class="small">â€» êµìœ¡/ì˜¤ë½ìš© ë°ëª¨ì…ë‹ˆë‹¤. ê±´ê°•Â·ë²•ë¥ Â·íˆ¬ì ë“±ì€ ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
      </div>
    </section>

    <section class="card" style="margin-top:14px">
      <details>
        <summary class="muted">ê°„ë‹¨ ì‚¬ìš© íŒ</summary>
        <ul class="tips muted">
          <li>ì§ˆë¬¸ì— â€œì—°ì• , ê¸ˆì „, ì§ì¥, í•™ì—…, ê±´ê°•â€ ê°™ì€ í‚¤ì›Œë“œë¥¼ ë„£ìœ¼ë©´ í˜„ì‹¤ ì¡°ì–¸ì´ ë” êµ¬ì²´í™”ë©ë‹ˆë‹¤.</li>
          <li>ì´ë¦„/ì‹œê°ì´ ê°™ì•„ë„ ë‚ ì§œê°€ ë‹¤ë¥´ë©´ ê²°ê³¼ í‚¤ì›Œë“œê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</li>
        </ul>
      </details>
    </section>
  </div>

  <script>
    // ========== 1) ì—°ê°„ì§€(ì…ì¶˜ ê·¼ì‚¬ ë³´ì •) ==========
    const GAN = ["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"];
    const JI  = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];
    function sexagenaryYear(dateStr){
      const d=new Date(dateStr); if(isNaN(d)) return ["?","?"];
      const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
      const base=(m<2)||(m===2&&day<4)? y-1 : y; // ì…ì¶˜(2/4) ê·¼ì‚¬
      return [ GAN[(base-4)%10], JI[(base-4)%12] ];
    }

    // ========== 2) ë„ë©”ì¸/í‚¤ì›Œë“œ/ì¡°ì–¸ ë£° ==========
    const LEFT='(?<![ê°€-í£a-z0-9])', RIGHT='(?![ê°€-í£a-z0-9])';
    const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    const pat = term => Array.isArray(term)
      ? new RegExp(`${LEFT}(?:${term.map(esc).join("|")})${RIGHT}`,"giu")
      : new RegExp(`${LEFT}${esc(term)}${RIGHT}`,"giu");

    const DOMAIN = {
      love:{label:"ì—°ì• ",terms:[
        "ì—°ì• ","ì‚¬ë‘","ì§ì‚¬ë‘","ì—°ì¸","ë°ì´íŠ¸","ê´€ê³„","ì†Œê°œíŒ…","ì¬íšŒ",
        "ë‚¨ìì¹œêµ¬","ì—¬ìì¹œêµ¬","ë‚¨ì¹œ","ì—¬ì¹œ","ì¸","í”ŒëŸ¬íŒ…","ë°€ë‹¹",
        ["ì‚¬ê·€","ì‚¬ê·ˆ","ì‚¬ê·€ì","ì‚¬ê·€ê³ ","ì‚¬ê·€ëŠ”","ì‚¬ê·€ì—ˆ","ì‚¬ê²¼","ì‚¬ê·"],["ì‚¬ê¸¸","ì‚¬ê¸°ê³ ","ì‚¬ê¸°ëŠ”"]
      ]},
      money:{label:"ê¸ˆì „",terms:[
        "ëˆ","ì§€ì¶œ","ìˆ˜ì…","ì˜ˆì‚°","ì €ì¶•","ì ˆì•½","ê°€ê³„ë¶€","í˜„ê¸ˆíë¦„",
        "íˆ¬ì","ì£¼ì‹","ì½”ì¸","ëŒ€ì¶œ","ì´ì","ì›”ì„¸","ì „ì„¸","ê°€ê²©","ë¹„ìš©","ì¹´ë“œê°’","ì²­êµ¬ì„œ","ê³ ì •ë¹„","ë³€ë™ë¹„","ì¶©ë™êµ¬ë§¤"
      ]},
      job:{label:"ì§ì¥/í•™ì—…",terms:[
        "ì§ì¥","íšŒì‚¬","ì—…ë¬´","í”„ë¡œì íŠ¸","ë³´ê³ ì„œ","íšŒì˜","ë§ˆê°","ë°ë“œë¼ì¸","ì•¼ê·¼","ì¶œê·¼",
        "ìŠ¹ì§„","ì´ì§","ë©´ì ‘","ì±„ìš©","ì»¤ë¦¬ì–´","ì¼ì •","ê³¼ì œ","ì‹œí—˜","í•™ì—…","ê³µë¶€"
      ]},
      health:{label:"ê±´ê°•",terms:[
        "ê±´ê°•","ìˆ˜ë©´","ë¶ˆë©´","í”¼ë¡œ","ì»¨ë””ì…˜","ìš´ë™","ë‹¤ì´ì–´íŠ¸","ìŠ¤íŠ¸ë ˆìŠ¤",
        "í†µì¦","ë‘í†µ","í—ˆë¦¬","ë””ìŠ¤í¬","ìì„¸","ê±°ë¶ëª©","ì–´ê¹¨","ìŠ¤íŠ¸ë ˆì¹­","ì˜ì–‘","ë©´ì—­","ì¹´í˜ì¸","ì»¤í”¼","ê³¼ë¡œ","ê°ê¸°"
      ]}
    };

    const ADVICE_RULES = {
      health: [
        {k:/ë””ìŠ¤í¬|í—ˆë¦¬|ìì„¸|ê±°ë¶ëª©/i, t:"í—ˆë¦¬/ìì„¸: 30~40ë¶„ë§ˆë‹¤ 1~2ë¶„ ì„œê¸° + ê°€ë²¼ìš´ í›„ë°© ì‹ ì „(ë§¥ì¼„ì§€) ìŠ¤íŠ¸ë ˆì¹­ì„ í•´ë³´ì„¸ìš”."},
        {k:/ìˆ˜ë©´|ë¶ˆë©´|í”¼ë¡œ/i,          t:"ìˆ˜ë©´: ì·¨ì¹¨ 3~4ì‹œê°„ ì „ ì¹´í˜ì¸Â·ê³¼ì‹ì„ ì¤„ì´ê³ , ê¸°ìƒ ì‹œê°„ì„ ê³ ì •í•˜ì„¸ìš”."},
        {k:/ì¹´í˜ì¸|ì»¤í”¼/i,             t:"ì¹´í˜ì¸ ì»·ì˜¤í”„ë¥¼ ì˜¤í›„ 2~3ì‹œë¡œ ë‘ë©´ ë°¤ ì»¨ë””ì…˜ì´ ì•ˆì •ë©ë‹ˆë‹¤."},
        {k:/ìš´ë™|ìŠ¤íŠ¸ë ˆì¹­/i,           t:"ìš´ë™: í†µì¦ ì‹œ ê³ ê°•ë„ë³´ë‹¤ ì›Œí‚¹Â·ê°€ë²¼ìš´ ì½”ì–´(í”Œë­í¬ 10~20ì´ˆÃ—3)ë¡œ ì‹œì‘í•˜ì„¸ìš”."},
        {k:/ì˜ì–‘|ë©´ì—­|ê°ê¸°/i,           t:"ì˜ì–‘: ìˆ˜ë¶„Â·ë‹¨ë°±ì§ˆ(ì²´ì¤‘Ã—1g ë‚´ì™¸) ë¨¼ì €, ê³¼ì¼Â·ì±„ì†Œë¡œ ë¯¸ì„¸ì˜ì–‘ì†Œ ë³´ê°•í•˜ì„¸ìš”."}
      ],
      money: [
        {k:/ëŒ€ì¶œ|ì´ì/i,                t:"ëŒ€ì¶œ: ë³€ë™ê¸ˆë¦¬ë¼ë©´ ê³ ì •/í˜¼í•© ë¹„êµì™€ ìƒí™˜ ìŠ¤ì¼€ì¤„ ì¬ì ê²€ìœ¼ë¡œ ì›” ë¶€ë‹´ì„ ì¤„ì´ì„¸ìš”."},
        {k:/ì›”ì„¸|ì „ì„¸|ì„ëŒ€/i,           t:"ì£¼ê±°ë¹„: ì´ì§€ì¶œì˜ 25~30% ì´ë‚´ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤. ì¡°ê±´ ì¬í˜‘ìƒ/ì´ë™ì„ ê²€í† í•˜ì„¸ìš”."},
        {k:/ì§€ì¶œ|ê°€ê³„ë¶€|ì¹´ë“œê°’|ì²­êµ¬ì„œ|ë¹„ìš©/i, t:"ì§€ì¶œ: êµ¬ë…/ì •ê¸°ê²°ì œë¶€í„° ì •ë¦¬í•˜ê³ , ê³ ì •ë¹„â†’ë³€ë™ë¹„ ìˆœìœ¼ë¡œ ì ê²€í•˜ì„¸ìš”."},
        {k:/ì¶©ë™êµ¬ë§¤|ì†Œë¹„/i,            t:"ì†Œë¹„: 'ì¥ë°”êµ¬ë‹ˆ 24ì‹œê°„ ê·œì¹™'ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ê²°ì œë¥¼ ì¤„ì—¬ë³´ì„¸ìš”."},
        {k:/íˆ¬ì|ì£¼ì‹|ì½”ì¸/i,           t:"íˆ¬ì: ë‹¨ê¸°ìˆ˜ìµë³´ë‹¤ ë¹„ìƒê¸ˆ(3~6ê°œì›”) í™•ë³´ë¥¼ ìš°ì„ í•˜ì„¸ìš”."}
      ],
      job: [
        {k:/ë©´ì ‘|ì±„ìš©/i,                t:"ë©´ì ‘: ì§ë¬´í•µì‹¬ 3í‚¤ì›Œë“œ ì¤‘ì‹¬ìœ¼ë¡œ (ê²½í—˜â†’ì—­í• â†’ê²°ê³¼â†’êµí›ˆ) ìŠ¤í† ë¦¬ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”."},
        {k:/ë³´ê³ ì„œ|íšŒì˜/i,              t:"ì—…ë¬´: ë¨¼ì € ìš”ì•½(ê²°ë¡ â†’ê·¼ê±°â†’ìš”ì²­)ì„ ì“°ë©´ ì†ë„ì™€ í”¼ë“œë°± í’ˆì§ˆì´ ê°™ì´ ì˜¤ë¦…ë‹ˆë‹¤."},
        {k:/ë§ˆê°|ë°ë“œë¼ì¸|ì•¼ê·¼/i,       t:"ë§ˆê°: ì˜¤ëŠ˜ 'ë°˜ë‚˜ì ˆ ë‹¹ê¹€' ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë¦¬ìŠ¤í¬ë¥¼ ì•ë‹¹ê²¨ í•´ì†Œí•˜ì„¸ìš”."},
        {k:/ê³¼ì œ|ì‹œí—˜|í•™ì—…|ê³µë¶€/i,      t:"í•™ìŠµ: 25ë¶„ ì§‘ì¤‘/5ë¶„ íœ´ì‹(í¬ëª¨ë„ë¡œ)ë¡œ ê¾¸ì¤€ì„±ì„ ë§Œë“œì„¸ìš”."}
      ],
      love: [
        {k:/ì‚¬ê·€|ì§ì‚¬ë‘|ê³ ë°±|ì¸|ì—°ì• |ì—°ì¸/i, t:"ì—°ì• : ì—°ë½ í…œí¬ë¥¼ ìƒëŒ€ í˜¸í¡ì— ë§ì¶”ê³ , 'ë‹¤ìŒ ë§Œë‚¨ ì œì•ˆ' í•œ ì¤„ì„ ë¯¸ë¦¬ ì¤€ë¹„í•˜ì„¸ìš”."}
      ]
    };

    const GENERIC = {
      health:["ìˆ˜ë©´ 30ë¶„ë§Œ ëŠ˜ë ¤ë„ íšŒë³µë ¥ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.","ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ê³¼ ìˆ˜ë¶„ ë³´ì¶©ìœ¼ë¡œ ì»¨ë””ì…˜ì„ ë‹¤ì§€ì„¸ìš”."],
      money:["ì§€ì¶œ í•œ ì¤„ë§Œ ì¤„ì—¬ë„ ì „ì²´ê°€ ì•ˆì •ë©ë‹ˆë‹¤.","ë¹„ìƒê¸ˆ(3~6ê°œì›”)ì„ ë¨¼ì € ë§Œë“¤ë©´ ì˜ì‚¬ê²°ì •ì´ ì‰¬ì›Œì§‘ë‹ˆë‹¤."],
      job:["ë©”ëª¨/ì •ë¦¬ë§Œ ì˜í•´ë„ ê²°ê³¼ê°€ ë°”ë€ë‹ˆë‹¤.","í”¼ë“œë°±ì„ ë¨¼ì € ìš”ì²­í•˜ë©´ ì‹ ë¢°ë„ê°€ ì˜¤ë¦…ë‹ˆë‹¤."],
      love:["ì§ì„¤ë³´ë‹¤ëŠ” ì†”ì§+ë¶€ë“œëŸ¬ì›€ì´ í†µí•˜ëŠ” ë‚ ì…ë‹ˆë‹¤.","ê¸°ëŒ€ì¹˜ë¥¼ ë‚®ì¶”ë©´ ì˜¤íˆë ¤ ì¢‹ì€ í¬ì¸íŠ¸ê°€ ë³´ì…ë‹ˆë‹¤."]
    };

    // ========== 3) ë¶„ë¥˜/ë°°ì§€ ==========
    function classify(textRaw){
      const text=(textRaw||"").normalize('NFKC').replace(/\s+/g,' ').toLowerCase();
      const score={love:0,money:0,job:0,health:0};
      for(const [dom,info] of Object.entries(DOMAIN)){
        for(const t of info.terms){ if(pat(t).test(text)) score[dom]+=3; }
      }
      const sorted=Object.entries(score).sort((a,b)=>b[1]-a[1]);
      return {score, sorted};
    }
    const badgeHtml = score => {
      const map={love:["â™¥ ì—°ì• ","love"], money:["ğŸ’° ê¸ˆì „","money"], job:["ğŸ’¼ ì§ì¥/í•™ì—…","job"], health:["ğŸ©º ê±´ê°•","health"]};
      return Object.entries(score).sort((a,b)=>b[1]-a[1]).filter(([_,v])=>v>0)
        .map(([k,v])=>`<span class="badge ${map[k][1]}">${map[k][0]}${v>=6?"(ê°•ì¡°)":""}</span>`).join(' ');
    };

    // ========== 4) ì„±í–¥/ì¡°ì–¸ =============
    const traitsGan={ "ê°‘":["ì£¼ì²´ì ","ê°œì²™ì ","ì§ì§„í˜•"], "ì„":["ìœ ì—°í•¨","ë°°ë ¤ì‹¬","ì„¬ì„¸í•¨"],
      "ë³‘":["ì—´ì •","í‘œí˜„ë ¥","ë‚™ì²œì„±"], "ì •":["ì°¨ë¶„í•¨","ì‹ ì¤‘í•¨","ê· í˜•ê°"],
      "ë¬´":["í˜„ì‹¤ê°ê°","ì±…ì„ê°","ëˆê¸°"], "ê¸°":["ë¶„ì„ë ¥","ê¼¼ê¼¼í•¨","ì‹¤ìš©ì„±"],
      "ê²½":["ê²°ë‹¨ë ¥","ë¦¬ë”ì‹­","ì¶”ì§„"],  "ì‹ ":["ì§€ì  í˜¸ê¸°ì‹¬","íƒêµ¬ì‹¬","ë³€í™” ì„ í˜¸"],
      "ì„":["ê°ìˆ˜ì„±","ìœ ì—°í•œ ì‚¬ê³ ","í¬ìš©"], "ê³„":["ì„¸ì‹¬í•¨","ê´€ì°°ë ¥","ë‚´ë©´ ì§‘ì¤‘"] };
    const traitsJi={
      "ì":["ë¯¼ì²©","ì§€í˜œ"],"ì¶•":["ì„±ì‹¤","ê¾¸ì¤€"],"ì¸":["ë„ì „","í™œë°œ"],"ë¬˜":["ê°ìˆ˜ì„±","ì˜ˆìˆ ì„±"],
      "ì§„":["ì•ˆì •","í˜„ì‹¤ì„±"],"ì‚¬":["ì‚¬êµ","í‘œí˜„"],"ì˜¤":["ì—´ì •","ì§ì„ "],"ë¯¸":["ì°¨ë¶„","ë°°ë ¤"],
      "ì‹ ":["ì˜ˆë¦¬","ëƒ‰ì² "],"ìœ ":["ì„¸ë ¨","ì§€ì„±"],"ìˆ ":["ì˜ë¦¬","ì‹ ë¢°"],"í•´":["ì˜¨í™”","ìˆœìˆ˜"]
    };

    const h32=s=>{let h=2166136261>>>0; for(const c of s){h^=c.charCodeAt(0); h=Math.imul(h,16777619)} return h>>>0;}
    const rnd=(seed)=>{seed=(seed+0x6D2B79F5)>>>0; let t=Math.imul(seed^seed>>>15,1|seed); t^=t+Math.imul(t^t>>>7,61|t); return ((t^t>>>14)>>>0)/4294967296;}
    const pick=(arr, r)=>arr[Math.floor(r*arr.length)]||arr[0];

    function ruleAdvices(primary, q){
      const set=ADVICE_RULES[primary]||[], pool=[];
      for(const r of set){ if(r.k.test(q)) pool.push(r.t); }
      return pool.length? pool : GENERIC[primary];
    }

    // ========== 5) ì‹¤í–‰ ==========
    function render(){
      const name=(document.getElementById('name').value||"ìµëª…").trim();
      const birth=document.getElementById('birth').value;
      const hourSel=document.getElementById('hour');
      const hourVal=hourSel.value;
      const q=(document.getElementById('q').value||"").trim();
      const outEl=document.getElementById('out');

      if(!birth){
        outEl.innerHTML='<span class="muted">ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.</span>';
        document.getElementById('birth').focus(); return;
      }

      const [g,j]=sexagenaryYear(birth);
      const {score,sorted}=classify(q);

      const top=sorted[0], second=sorted[1];
      const useSecond = second && second[1] >= Math.max(3, top[1]-1);
      const primary = top[1]>0 ? top[0] : null;

      const todayISO=new Date().toISOString().slice(0,10);
      const seed=h32(name+"|"+birth+"|"+todayISO+"|"+(hourVal||""));
      const r1=rnd(seed), r2=rnd(seed^0x9e3779b9);

      const tg=traitsGan[g]||["ê· í˜•","ì„±ì‹¤","ì•ˆì •"], tj=traitsJi[j]||["ì¡°í™”","ìœ ì—°","ì°¨ë¶„"];
      const t1=pick(tg,r1), t2=pick(tj,r2);

      let advLines=[];
      if(primary){
        const a1=pick(ruleAdvices(primary,q), r1);
        advLines.push(`<li><b>${DOMAIN[primary].label}</b>: ${a1}</li>`);
      }
      if(useSecond){
        const dom=second[0];
        const a2=pick(ruleAdvices(dom,q), r2);
        advLines.push(`<li><b>${DOMAIN[dom].label}</b>: ${a2}</li>`);
      }
      if(advLines.length===0){
        advLines.push(`<li><b>ì¼ë°˜</b>: ì˜¤ëŠ˜ì€ ì‘ì€ ë£¨í‹´(ìˆ˜ë©´Â·ì‹ì‚¬Â·ì •ë¦¬)ì„ ì•ˆì •ì‹œí‚¤ë©´ íë¦„ì´ ì¢‹ì•„ìš”.</li>`);
      }

      const html = `
        <div class="kv"><b>ëŒ€ìƒ</b> <div>${name}</div></div>
        <div class="kv"><b>ì—°ê°„ì§€</b> <div class="hl mono">${g}${j}</div></div>
        <div class="kv"><b>ê´€ì‹¬ ë¶„ì•¼</b> <div class="badges">${badgeHtml(score) || "í•´ë‹¹ ì—†ìŒ"}</div></div>
        <div class="kv"><b>ì„±í–¥ í‚¤ì›Œë“œ</b> <div>${t1}, ${t2}</div></div>
        <div class="kv"><b>í•µì‹¬ ë¬¸ì¥</b> <div>ì˜¤ëŠ˜ì€ <span class="hl">${t1}</span>ì„(ë¥¼) ì‚´ë¦¬ê³  <span class="hl">${t2}</span>ì˜ ê· í˜•ì„ ì¡ìœ¼ë©´ íë¦„ì´ ì¢‹ì•„ìš”.</div></div>
        <div class="kv"><b>ì˜¤ëŠ˜ì˜ ì¡°ì–¸</b>
          <div><ul>${advLines.join("")}</ul></div>
        </div>
        <div class="small">â€» ë³¸ ê²°ê³¼ëŠ” ë£°/í‚¤ì›Œë“œ ê¸°ë°˜ì˜ êµìœ¡Â·ì˜¤ë½ìš© ë°ëª¨ì…ë‹ˆë‹¤. ê±´ê°•Â·ë²•ë¥ Â·íˆ¬ì ë“±ì€ ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</div>
      `;
      outEl.innerHTML = html;
    }

    // ì´ˆê¸°ê°’: ì˜¤ëŠ˜ ë‚ ì§œ
    (function init(){
      const birth=document.getElementById('birth');
      if(!birth.value) birth.value = new Date().toISOString().slice(0,10);
      document.getElementById('run').addEventListener('click', render);

      // Enter ì‹¤í–‰(ì§ˆë¬¸ì¹¸ì— í¬ì»¤ìŠ¤ì¼ ë• ì œì™¸)
      document.addEventListener('keydown', (e)=>{
        const active = document.activeElement;
        if(e.key==='Enter' && active && active.id!=='q'){ e.preventDefault(); render(); }
      });
    })();
  </script>
</body>
</html>
