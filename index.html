<!doctype html>
<html lang="ko">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>ì‚¬ì£¼ í’€ì´</title>

Â  Â  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”®</text></svg>">

Â  <style>
Â  Â  :root{ --bg:#0f1320; --fg:#eef2ff; --muted:#9aa3b2;
Â  Â  Â  --card:#141a33; --line:#243055; --accent:#76a7ff;
Â  Â  Â  --love:#ffe8ef; --money:#e8fff1; --job:#e8f1ff; --health:#fff6e8;
Â  Â  }
Â  Â  *{box-sizing:border-box}
Â  Â  html,body{height:100%}
Â  Â  body{
Â  Â  Â  margin:0; font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
Â  Â  Â  color:var(--fg);
Â  Â  Â  background:linear-gradient(180deg,#0b1020,#0c1226 35%,#0b1020 100%);
Â  Â  }
Â  Â  .wrap{max-width:880px;margin:28px auto;padding:0 16px}
Â  Â  header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
Â  Â  header h1{font-size:22px;margin:0}
Â  Â  header .sub{color:var(--muted);font-size:13px}
Â  Â  .card{background:var(--card); border:1px solid var(--line);
Â  Â  Â  border-radius:16px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.18);}
Â  Â  .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
Â  Â  @media (max-width:720px){ .grid{grid-template-columns:1fr} }
Â  Â  label{display:block; margin:8px 0 6px; font-weight:600}
Â  Â  input,select,textarea,button{
Â  Â  Â  width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line);
Â  Â  Â  background:#0e1530; color:var(--fg); outline:none;
Â  Â  }
Â  Â  input:focus,select:focus,textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(118,167,255,.2)}
Â  Â  textarea{min-height:92px; resize:vertical}
Â  Â  .actions{display:flex; gap:10px; align-items:center; margin-top:8px}
Â  Â  .btn{
Â  Â  Â  background:linear-gradient(180deg,#7db3ff,#6aa2ff 60%,#5b94fb 100%);
Â  Â  Â  color:#091224; border:none; font-weight:700; letter-spacing:.2px; cursor:pointer;
Â  Â  Â  transition:transform .05s ease, filter .2s ease; padding:10px 14px; border-radius:12px;
Â  Â  }
Â  Â  .btn:active{transform:translateY(1px)}
Â  Â  .btn[disabled]{filter:grayscale(1); opacity:.6; cursor:not-allowed}
Â  Â  .out{margin-top:16px}
Â  Â  .result{border:1px dashed var(--line); border-radius:14px; padding:16px; background:#0e1430;}
Â  Â  .badges{display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 2px}
Â  Â  .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
Â  Â  Â  font-size:12px; border:1px solid rgba(255,255,255,.08); color:#0f172a; font-weight:700}
Â  Â  .badge.love{background:var(--love)} .badge.money{background:var(--money)}
Â  Â  .badge.job{background:var(--job)} .badge.health{background:var(--health)}
Â  Â  .kv{display:grid; grid-template-columns:112px 1fr; gap:10px; margin:10px 0}
Â  Â  @media (max-width:520px){ .kv{grid-template-columns:1fr} .kv b{display:block;margin-bottom:4px} }
Â  Â  .muted{color:var(--muted); font-size:13px}
Â  Â  .small{color:var(--muted); font-size:12px; margin-top:10px}
Â  Â  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
Â  Â  .hl{color:#bfe1ff}
Â  Â  .tips li{margin:4px 0}
Â  </style>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js" defer></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@latest/dist/transformers.min.js" defer></script>
</head>
<body>
Â  <div class="wrap">
Â  Â  <header>
Â  Â  Â  <h1>ì‚¬ì£¼ í’€ì´</h1>
Â  Â  Â  <span class="sub">ê°€ë²¼ìš´ í‚¤ì›Œë“œ ë£°ë¡œ ì˜¤ëŠ˜ í•œ ì¤„ ì¡°ì–¸ê¹Œì§€</span>
Â  Â  </header>

Â  Â  <section class="card">
Â  Â  Â  <div class="grid">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="name">ì´ë¦„</label>
Â  Â  Â  Â  Â  <input id="name" placeholder="ì´ë¦„(ì„ íƒ)"/>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="birth">ìƒë…„ì›”ì¼</label>
Â  Â  Â  Â  Â  <input id="birth" type="date" />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="grid">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="hour">íƒœì–´ë‚œ ì‹œê°</label>
Â  Â  Â  Â  Â  <select id="hour">
Â  Â  Â  Â  Â  Â  <option value="" selected>ì„ íƒí•˜ì„¸ìš”</option>
Â  Â  Â  Â  Â  Â  <option value="0">ì(23~01)</option><option value="2">ì¶•(01~03)</option>
Â  Â  Â  Â  Â  Â  <option value="4">ì¸(03~05)</option><option value="6">ë¬˜(05~07)</option>
Â  Â  Â  Â  Â  Â  <option value="8">ì§„(07~09)</option><option value="10">ì‚¬(09~11)</option>
Â  Â  Â  Â  Â  Â  <option value="12">ì˜¤(11~13)</option><option value="14">ë¯¸(13~15)</option>
Â  Â  Â  Â  Â  Â  <option value="16">ì‹ (15~17)</option><option value="18">ìœ (17~19)</option>
Â  Â  Â  Â  Â  Â  <option value="20">ìˆ (19~21)</option><option value="22">í•´(21~23)</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  <div class="small">ì •í™•í•œ ì‹œê°ì„ ëª¨ë¥´ë©´ ëŒ€ëµ ê·¼ì‚¬ê°’ì„ ì„ íƒí•´ë„ ë©ë‹ˆë‹¤.</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label for="q">ì§ˆë¬¸/ê³ ë¯¼(ì„ íƒ)</label>
Â  Â  Â  Â  Â  <textarea id="q" placeholder=""></textarea>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="actions">
Â  Â  Â  Â  <button id="run" class="btn">í’€ì´í•˜ê¸°</button>
Â  Â  Â  Â  <span class="muted mono">Enterë¡œë„ ì‹¤í–‰(ì§ˆë¬¸ì¹¸ ì œì™¸)</span>
Â  Â  Â  </div>

Â  Â  Â  <div class="out">
Â  Â  Â  Â  <div id="out" class="result muted">ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
Â  Â  Â  Â  <p class="small">â€» êµìœ¡/ì˜¤ë½ìš© ë°ëª¨ì…ë‹ˆë‹¤. ê±´ê°•Â·ë²•ë¥ Â·íˆ¬ì ë“±ì€ ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
Â  Â  Â  </div>
Â  Â  </section>
Â  </div>

Â  Â  <script>
Â  Â  const pickName = (cands, names) => cands.find(c => names.includes(c)) ?? names[0];

Â  Â  document.addEventListener('DOMContentLoaded', async () => {
Â  Â  Â  if (!window.transformers) {
Â  Â  Â  Â  console.error('Transformers.js ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
Â  Â  Â  Â  document.getElementById('out').textContent = 'âš  ì˜¤ë¥˜: Transformers.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const { env, AutoTokenizer } = window.transformers;

Â  Â  Â  // --- ì„¤ì • ---
Â  Â  Â  env.allowLocalModels = true;
Â  Â  Â  env.localModelPath = './'; // ë£¨íŠ¸ì— /web_model/** í•„ìš”
Â  Â  Â  const MODEL_URL = 'https://github.com/tordox205/saju-web/releases/download/v1/model.onnx';

Â  Â  Â  try {
Â  Â  Â  Â  // --- ì´ˆê¸°í™” ---
Â  Â  Â  Â  const tokenizer = await AutoTokenizer.from_pretrained('web_model');

Â  Â  Â  Â  ort.env.wasm.numThreads = navigator.hardwareConcurrency || 4;
Â  Â  Â  Â  const providers = ('gpu' in navigator) ? ['webgpu','wasm'] : ['wasm'];
Â  Â  Â  Â  const session = await ort.InferenceSession.create(MODEL_URL, {
Â  Â  Â  Â  Â  executionProviders: providers,
Â  Â  Â  Â  Â  graphOptimizationLevel: 'all',
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- ìœ í‹¸ ---
Â  Â  Â  Â  async function encodeText(text){
Â  Â  Â  Â  Â  const e = (tokenizer.encode) ? await tokenizer.encode(text) : await tokenizer(text);
Â  Â  Â  Â  Â  if (e?.ids) return e.ids;
Â  Â  Â  Â  Â  if (e?.input_ids?.data) return Array.from(e.input_ids.data);
Â  Â  Â  Â  Â  if (Array.isArray(e?.input_ids)) return e.input_ids;
Â  Â  Â  Â  Â  throw new Error('tokenize ì‹¤íŒ¨');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function decodeIds(ids){
Â  Â  Â  Â  Â  if (tokenizer.decode) return await tokenizer.decode(ids, { skip_special_tokens: true });
Â  Â  Â  Â  Â  if (tokenizer.batch_decode) return (await tokenizer.batch_decode([ids], { skip_special_tokens: true }))[0];
Â  Â  Â  Â  Â  throw new Error('decode ì‹¤íŒ¨');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function generateGreedy(prompt, maxNew=220){
Â  Â  Â  Â  Â  let ids = Int32Array.from(await encodeText(prompt));

Â  Â  Â  Â  Â  const name_in = pickName(['input_ids','inputs','tokens'], session.inputNames);
Â  Â  Â  Â  Â  const name_mask = pickName(['attention_mask','attn_mask','mask'], session.inputNames);
Â  Â  Â  Â  Â  const name_out = pickName(['logits','output','logits_out'], session.outputNames);

Â  Â  Â  Â  Â  const eos = (typeof window.eosId === 'number') ? window.eosId : -1;

Â  Â  Â  Â  Â  for (let step=0; step<maxNew; step++){
Â  Â  Â  Â  Â  Â  const mask = new Int32Array(ids.length).fill(1);
Â  Â  Â  Â  Â  Â  const feeds = { [name_in]: new ort.Tensor('int32', ids, [1, ids.length]) };
Â  Â  Â  Â  Â  Â  if (name_mask) feeds[name_mask] = new ort.Tensor('int32', mask, [1, mask.length]);

Â  Â  Â  Â  Â  Â  const out = await session.run(feeds);
Â  Â  Â  Â  Â  Â  const logits = out[name_out];
Â  Â  Â  Â  Â  Â  const seqLen = logits.dims[1], V = logits.dims[2];
Â  Â  Â  Â  Â  Â  const base = (seqLen - 1) * V;

Â  Â  Â  Â  Â  Â  let nextId = 0, best = -Infinity;
Â  Â  Â  Â  Â  Â  for (let i=0;i<V;i++){
Â  Â  Â  Â  Â  Â  Â  const v = logits.data[base + i];
Â  Â  Â  Â  Â  Â  Â  if (v > best){ best = v; nextId = i; }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (nextId === eos) break;

Â  Â  Â  Â  Â  Â  const next = new Int32Array(ids.length + 1);
Â  Â  Â  Â  Â  Â  next.set(ids); next[ids.length] = nextId; ids = next;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return await decodeIds(Array.from(ids));
Â  Â  Â  Â  }

Â  Â  Â  Â  function buildPrompt({name,birth,hour,q}){
Â  Â  Â  Â  Â  const who = name ? `ì´ë¦„: ${name}\n` : '';
Â  Â  Â  Â  Â  const hr = hour || 'ëª¨ë¦„(ê·¼ì‚¬)';
Â  Â  Â  Â  Â  const qq = q ? `ì§ˆë¬¸: ${q}\n` : '';
Â  Â  Â  Â  Â  return `[ì‚¬ì£¼ì…ë ¥]
${who}ìƒë…„ì›”ì¼: ${birth}
íƒœì–´ë‚œ ì‹œê°: ${hr}
${qq}[ì§€ì‹œ]
- ì—°ì• /ê¸ˆì „/ì§ì—…/ê±´ê°• ì¤‘ì‹¬ìœ¼ë¡œ ê°„ë‹¨ í‚¤ì›Œë“œ í’€ì´ í›„ ì˜¤ëŠ˜ì˜ í•œ ì¤„.
- ê³¼ì¥ ê¸ˆì§€, ë³´ìˆ˜ì  í†¤.
[ì¶œë ¥]`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- UI ---
Â  Â  Â  Â  const btn = document.getElementById('run');
Â  Â  Â  Â  const out = document.getElementById('out');

Â  Â  Â  Â  btn.addEventListener('click', async ()=>{
Â  Â  Â  Â  Â  const name = (document.getElementById('name').value||'').trim();
Â  Â  Â  Â  Â  const birth = document.getElementById('birth').value;
Â  Â  Â  Â  Â  const hour = document.getElementById('hour').value;
Â  Â  Â  Â  Â  const q = (document.getElementById('q')?.value||'').trim();

Â  Â  Â  Â  Â  if (!birth){ out.textContent='ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.'; return; }

Â  Â  Â  Â  Â  btn.disabled = true; out.textContent = 'ìƒì„± ì¤‘â€¦';
Â  Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  Â  const prompt = buildPrompt({name,birth,hour,q});
Â  Â  Â  Â  Â  Â  const text = await generateGreedy(prompt, 220);
Â  Â  Â  Â  Â  Â  out.textContent = (text||'').replaceAll('<unk>','').trim() || 'ê²°ê³¼ ì—†ìŒ';
Â  Â  Â  Â  Â  }catch(e){
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  out.textContent = 'âš  ì˜¤ë¥˜: ' + (e?.message || e);
Â  Â  Â  Â  Â  }finally{
Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  document.addEventListener('keydown',(e)=>{
Â  Â  Â  Â  Â  const active = document.activeElement;
Â  Â  Â  Â  Â  if(e.key==='Enter' && active && active.id!=='q'){
Â  Â  Â  Â  Â  Â  e.preventDefault(); btn.click();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // ë””ë²„ê·¸ í—¬í¼
Â  Â  Â  Â  window.testONNX = async () => {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const enc = (await tokenizer.encode('í…ŒìŠ¤íŠ¸')).ids;
Â  Â  Â  Â  Â  Â  const name_in = pickName(['input_ids','inputs','tokens'], session.inputNames);
Â  Â  Â  Â  Â  Â  const name_mask = pickName(['attention_mask','attn_mask','mask'], session.inputNames);
Â  Â  Â  Â  Â  Â  const out = await session.run({
Â  Â  Â  Â  Â  Â  Â  [name_in]: new ort.Tensor('int32', Int32Array.from(enc), [1, enc.length]),
Â  Â  Â  Â  Â  Â  Â  [name_mask]: new ort.Tensor('int32', new Int32Array(enc.length).fill(1), [1, enc.length]),
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return Object.keys(out);
Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  return 'run error: ' + (e?.message || e);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', err);
Â  Â  Â  Â  document.getElementById('out').textContent = 'ì´ˆê¸°í™” ì˜¤ë¥˜: ' + (err?.message || err);
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>