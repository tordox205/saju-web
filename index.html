<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>사주 풀이</title>
  <style>
    :root{
      --bg:#0f1320; --fg:#eef2ff; --muted:#9aa3b2;
      --card:#141a33; --line:#243055; --accent:#76a7ff;
      --love:#ffe8ef; --money:#e8fff1; --job:#e8f1ff; --health:#fff6e8;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
      color:var(--fg);
      background:linear-gradient(180deg,#0b1020,#0c1226 35%,#0b1020 100%);
    }
    .wrap{max-width:880px;margin:28px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    header h1{font-size:22px;margin:0}
    header .sub{color:var(--muted);font-size:13px}

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.18);
    }
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){ .grid{grid-template-columns:1fr} }

    label{display:block; margin:8px 0 6px; font-weight:600}
    input,select,textarea,button{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line);
      background:#0e1530; color:var(--fg); outline:none;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(118,167,255,.2)}
    textarea{min-height:92px; resize:vertical}

    .actions{display:flex; gap:10px; align-items:center; margin-top:8px}
    .btn{
      background:linear-gradient(180deg,#7db3ff,#6aa2ff 60%,#5b94fb 100%);
      color:#091224; border:none; font-weight:700; letter-spacing:.2px; cursor:pointer;
      transition:transform .05s ease, filter .2s ease; padding:10px 14px; border-radius:12px;
    }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{filter:grayscale(1); opacity:.6; cursor:not-allowed}

    .out{margin-top:16px}
    .result{
      border:1px dashed var(--line); border-radius:14px; padding:16px; background:#0e1430;
    }
    .badges{display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 2px}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      font-size:12px; border:1px solid rgba(255,255,255,.08); color:#0f172a; font-weight:700}
    .badge.love{background:var(--love)} .badge.money{background:var(--money)}
    .badge.job{background:var(--job)} .badge.health{background:var(--health)}

    .kv{display:grid; grid-template-columns:112px 1fr; gap:10px; margin:10px 0}
    @media (max-width:520px){ .kv{grid-template-columns:1fr} .kv b{display:block;margin-bottom:4px} }
    .muted{color:var(--muted); font-size:13px}
    .small{color:var(--muted); font-size:12px; margin-top:10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .hl{color:#bfe1ff}
    .tips li{margin:4px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>사주 풀이</h1>
      <span class="sub">가벼운 키워드 룰로 오늘 한 줄 조언까지</span>
    </header>

    <section class="card">
      <div class="grid">
        <div>
          <label for="name">이름</label>
          <input id="name" placeholder="이름(선택)"/>
        </div>
        <div>
          <label for="birth">생년월일</label>
          <input id="birth" type="date" />
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="hour">태어난 시각</label>
          <select id="hour">
            <option value="" selected>선택하세요</option>
            <option value="0">자(23~01)</option><option value="2">축(01~03)</option>
            <option value="4">인(03~05)</option><option value="6">묘(05~07)</option>
            <option value="8">진(07~09)</option><option value="10">사(09~11)</option>
            <option value="12">오(11~13)</option><option value="14">미(13~15)</option>
            <option value="16">신(15~17)</option><option value="18">유(17~19)</option>
            <option value="20">술(19~21)</option><option value="22">해(21~23)</option>
          </select>
          <div class="small">정확한 시각을 모르면 대략 근사값을 선택해도 됩니다.</div>
        </div>
        <div>
          <label for="q">질문/고민(선택)</label>
          <textarea id="q" placeholder=""></textarea>
        </div>
      </div>

      <div class="actions">
        <button id="run" class="btn">풀이하기</button>
        <span class="muted mono">Enter로도 실행(질문칸 제외)</span>
      </div>

      <div class="out">
        <div id="out" class="result muted">여기에 결과가 표시됩니다.</div>
        <p class="small">※ 교육/오락용 데모입니다. 건강·법률·투자 등은 전문가 상담을 권장합니다.</p>
      </div>
    </section>

    <section class="card" style="margin-top:14px">
      <details>
        <summary class="muted">간단 사용 팁</summary>
        <ul class="tips muted">
          <li>질문에 “연애, 금전, 직장, 학업, 건강” 같은 키워드를 넣으면 현실 조언이 더 구체화됩니다.</li>
          <li>이름/시각이 같아도 날짜가 다르면 결과 키워드가 달라질 수 있어요.</li>
        </ul>
      </details>
    </section>
  </div>

  <script>
    // ========== 1) 연간지(입춘 근사 보정) ==========
    const GAN = ["갑","을","병","정","무","기","경","신","임","계"];
    const JI  = ["자","축","인","묘","진","사","오","미","신","유","술","해"];
    function sexagenaryYear(dateStr){
      const d=new Date(dateStr); if(isNaN(d)) return ["?","?"];
      const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
      const base=(m<2)||(m===2&&day<4)? y-1 : y; // 입춘(2/4) 근사
      return [ GAN[(base-4)%10], JI[(base-4)%12] ];
    }

    // ========== 2) 도메인/키워드/조언 룰 ==========
    const LEFT='(?<![가-힣a-z0-9])', RIGHT='(?![가-힣a-z0-9])';
    const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    const pat = term => Array.isArray(term)
      ? new RegExp(`${LEFT}(?:${term.map(esc).join("|")})${RIGHT}`,"giu")
      : new RegExp(`${LEFT}${esc(term)}${RIGHT}`,"giu");

    const DOMAIN = {
      love:{label:"연애",terms:[
        "연애","사랑","짝사랑","연인","데이트","관계","소개팅","재회",
        "남자친구","여자친구","남친","여친","썸","플러팅","밀당",
        ["사귀","사귈","사귀자","사귀고","사귀는","사귀었","사겼","사귐"],["사길","사기고","사기는"]
      ]},
      money:{label:"금전",terms:[
        "돈","지출","수입","예산","저축","절약","가계부","현금흐름",
        "투자","주식","코인","대출","이자","월세","전세","가격","비용","카드값","청구서","고정비","변동비","충동구매"
      ]},
      job:{label:"직장/학업",terms:[
        "직장","회사","업무","프로젝트","보고서","회의","마감","데드라인","야근","출근",
        "승진","이직","면접","채용","커리어","일정","과제","시험","학업","공부"
      ]},
      health:{label:"건강",terms:[
        "건강","수면","불면","피로","컨디션","운동","다이어트","스트레스",
        "통증","두통","허리","디스크","자세","거북목","어깨","스트레칭","영양","면역","카페인","커피","과로","감기"
      ]}
    };

    const ADVICE_RULES = {
      health: [
        {k:/디스크|허리|자세|거북목/i, t:"허리/자세: 30~40분마다 1~2분 서기 + 가벼운 후방 신전(맥켄지) 스트레칭을 해보세요."},
        {k:/수면|불면|피로/i,          t:"수면: 취침 3~4시간 전 카페인·과식을 줄이고, 기상 시간을 고정하세요."},
        {k:/카페인|커피/i,             t:"카페인 컷오프를 오후 2~3시로 두면 밤 컨디션이 안정됩니다."},
        {k:/운동|스트레칭/i,           t:"운동: 통증 시 고강도보다 워킹·가벼운 코어(플랭크 10~20초×3)로 시작하세요."},
        {k:/영양|면역|감기/i,           t:"영양: 수분·단백질(체중×1g 내외) 먼저, 과일·채소로 미세영양소 보강하세요."}
      ],
      money: [
        {k:/대출|이자/i,                t:"대출: 변동금리라면 고정/혼합 비교와 상환 스케줄 재점검으로 월 부담을 줄이세요."},
        {k:/월세|전세|임대/i,           t:"주거비: 총지출의 25~30% 이내가 안정적입니다. 조건 재협상/이동을 검토하세요."},
        {k:/지출|가계부|카드값|청구서|비용/i, t:"지출: 구독/정기결제부터 정리하고, 고정비→변동비 순으로 점검하세요."},
        {k:/충동구매|소비/i,            t:"소비: '장바구니 24시간 규칙'으로 불필요한 결제를 줄여보세요."},
        {k:/투자|주식|코인/i,           t:"투자: 단기수익보다 비상금(3~6개월) 확보를 우선하세요."}
      ],
      job: [
        {k:/면접|채용/i,                t:"면접: 직무핵심 3키워드 중심으로 (경험→역할→결과→교훈) 스토리를 준비하세요."},
        {k:/보고서|회의/i,              t:"업무: 먼저 요약(결론→근거→요청)을 쓰면 속도와 피드백 품질이 같이 오릅니다."},
        {k:/마감|데드라인|야근/i,       t:"마감: 오늘 '반나절 당김' 체크리스트로 리스크를 앞당겨 해소하세요."},
        {k:/과제|시험|학업|공부/i,      t:"학습: 25분 집중/5분 휴식(포모도로)로 꾸준성을 만드세요."}
      ],
      love: [
        {k:/사귀|짝사랑|고백|썸|연애|연인/i, t:"연애: 연락 템포를 상대 호흡에 맞추고, '다음 만남 제안' 한 줄을 미리 준비하세요."}
      ]
    };

    const GENERIC = {
      health:["수면 30분만 늘려도 회복력이 달라집니다.","가벼운 스트레칭과 수분 보충으로 컨디션을 다지세요."],
      money:["지출 한 줄만 줄여도 전체가 안정됩니다.","비상금(3~6개월)을 먼저 만들면 의사결정이 쉬워집니다."],
      job:["메모/정리만 잘해도 결과가 바뀝니다.","피드백을 먼저 요청하면 신뢰도가 오릅니다."],
      love:["직설보다는 솔직+부드러움이 통하는 날입니다.","기대치를 낮추면 오히려 좋은 포인트가 보입니다."]
    };

    // ========== 3) 분류/배지 ==========
    function classify(textRaw){
      const text=(textRaw||"").normalize('NFKC').replace(/\s+/g,' ').toLowerCase();
      const score={love:0,money:0,job:0,health:0};
      for(const [dom,info] of Object.entries(DOMAIN)){
        for(const t of info.terms){ if(pat(t).test(text)) score[dom]+=3; }
      }
      const sorted=Object.entries(score).sort((a,b)=>b[1]-a[1]);
      return {score, sorted};
    }
    const badgeHtml = score => {
      const map={love:["♥ 연애","love"], money:["💰 금전","money"], job:["💼 직장/학업","job"], health:["🩺 건강","health"]};
      return Object.entries(score).sort((a,b)=>b[1]-a[1]).filter(([_,v])=>v>0)
        .map(([k,v])=>`<span class="badge ${map[k][1]}">${map[k][0]}${v>=6?"(강조)":""}</span>`).join(' ');
    };

    // ========== 4) 성향/조언 =============
    const traitsGan={ "갑":["주체적","개척적","직진형"], "을":["유연함","배려심","섬세함"],
      "병":["열정","표현력","낙천성"], "정":["차분함","신중함","균형감"],
      "무":["현실감각","책임감","끈기"], "기":["분석력","꼼꼼함","실용성"],
      "경":["결단력","리더십","추진"],  "신":["지적 호기심","탐구심","변화 선호"],
      "임":["감수성","유연한 사고","포용"], "계":["세심함","관찰력","내면 집중"] };
    const traitsJi={
      "자":["민첩","지혜"],"축":["성실","꾸준"],"인":["도전","활발"],"묘":["감수성","예술성"],
      "진":["안정","현실성"],"사":["사교","표현"],"오":["열정","직선"],"미":["차분","배려"],
      "신":["예리","냉철"],"유":["세련","지성"],"술":["의리","신뢰"],"해":["온화","순수"]
    };

    const h32=s=>{let h=2166136261>>>0; for(const c of s){h^=c.charCodeAt(0); h=Math.imul(h,16777619)} return h>>>0;}
    const rnd=(seed)=>{seed=(seed+0x6D2B79F5)>>>0; let t=Math.imul(seed^seed>>>15,1|seed); t^=t+Math.imul(t^t>>>7,61|t); return ((t^t>>>14)>>>0)/4294967296;}
    const pick=(arr, r)=>arr[Math.floor(r*arr.length)]||arr[0];

    function ruleAdvices(primary, q){
      const set=ADVICE_RULES[primary]||[], pool=[];
      for(const r of set){ if(r.k.test(q)) pool.push(r.t); }
      return pool.length? pool : GENERIC[primary];
    }

    // ========== 5) 실행 ==========
    function render(){
      const name=(document.getElementById('name').value||"익명").trim();
      const birth=document.getElementById('birth').value;
      const hourSel=document.getElementById('hour');
      const hourVal=hourSel.value;
      const q=(document.getElementById('q').value||"").trim();
      const outEl=document.getElementById('out');

      if(!birth){
        outEl.innerHTML='<span class="muted">생년월일을 입력하세요.</span>';
        document.getElementById('birth').focus(); return;
      }

      const [g,j]=sexagenaryYear(birth);
      const {score,sorted}=classify(q);

      const top=sorted[0], second=sorted[1];
      const useSecond = second && second[1] >= Math.max(3, top[1]-1);
      const primary = top[1]>0 ? top[0] : null;

      const todayISO=new Date().toISOString().slice(0,10);
      const seed=h32(name+"|"+birth+"|"+todayISO+"|"+(hourVal||""));
      const r1=rnd(seed), r2=rnd(seed^0x9e3779b9);

      const tg=traitsGan[g]||["균형","성실","안정"], tj=traitsJi[j]||["조화","유연","차분"];
      const t1=pick(tg,r1), t2=pick(tj,r2);

      let advLines=[];
      if(primary){
        const a1=pick(ruleAdvices(primary,q), r1);
        advLines.push(`<li><b>${DOMAIN[primary].label}</b>: ${a1}</li>`);
      }
      if(useSecond){
        const dom=second[0];
        const a2=pick(ruleAdvices(dom,q), r2);
        advLines.push(`<li><b>${DOMAIN[dom].label}</b>: ${a2}</li>`);
      }
      if(advLines.length===0){
        advLines.push(`<li><b>일반</b>: 오늘은 작은 루틴(수면·식사·정리)을 안정시키면 흐름이 좋아요.</li>`);
      }

      const html = `
        <div class="kv"><b>대상</b> <div>${name}</div></div>
        <div class="kv"><b>연간지</b> <div class="hl mono">${g}${j}</div></div>
        <div class="kv"><b>관심 분야</b> <div class="badges">${badgeHtml(score) || "해당 없음"}</div></div>
        <div class="kv"><b>성향 키워드</b> <div>${t1}, ${t2}</div></div>
        <div class="kv"><b>핵심 문장</b> <div>오늘은 <span class="hl">${t1}</span>을(를) 살리고 <span class="hl">${t2}</span>의 균형을 잡으면 흐름이 좋아요.</div></div>
        <div class="kv"><b>오늘의 조언</b>
          <div><ul>${advLines.join("")}</ul></div>
        </div>
        <div class="small">※ 본 결과는 룰/키워드 기반의 교육·오락용 데모입니다. 건강·법률·투자 등은 전문가 상담을 권장합니다.</div>
      `;
      outEl.innerHTML = html;
    }

    // 초기값: 오늘 날짜
    (function init(){
      const birth=document.getElementById('birth');
      if(!birth.value) birth.value = new Date().toISOString().slice(0,10);
      document.getElementById('run').addEventListener('click', render);

      // Enter 실행(질문칸에 포커스일 땐 제외)
      document.addEventListener('keydown', (e)=>{
        const active = document.activeElement;
        if(e.key==='Enter' && active && active.id!=='q'){ e.preventDefault(); render(); }
      });
    })();
  </script>
</body>
</html>
